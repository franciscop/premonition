/* premonition@0.2.1 · MIT · Francisco Presencia https://francisco.io/*/
(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define(b):a.pre=b()})(this,function(){'use strict';async function a(a='a'){await new Promise(a=>'complete'===document.readyState?a():void document.addEventListener('DOMContentLoaded',a,!1)),this.cache.set(window.location.href,{href:window.location.href,html:i('html')[0].outerHTML}),i(`script[${this.attrs.once}]`).forEach(a=>this.loaded[a.src]=!0),i(a).forEach(a=>{a.host!==location.host||(a.addEventListener('mouseover',a=>this.load(a.currentTarget)),a.addEventListener('touchstart',a=>this.load(a.currentTarget)),a.addEventListener('click',a=>(a.preventDefault(),this.open(a.currentTarget))))})}function b(a){const b=a.href||a;return this.loader[b]?this.loader[b]:this.cache.get(b)?Promise.resolve(this.cache.get(b)):(this.loader[b]=fetch(b).then(a=>(a.ok||this.report(new Error(a.statusText)),a.text())).then(a=>(this.cache.set(b,{href:b,html:a}),delete this.loader[b],this.cache.get(b))),this.loader[b])}async function c(a){const b=a.href||a;try{const a=await this.load(b);return await this.merge(a),this.init()}catch(a){this.report(a),location.href=b}}function d(a='a'){const b=Object.keys(this.cache.cache);i(a).forEach(a=>{if(b.includes(a.href))return a.getAttribute(this.attrs.cache)?void 0:a.setAttribute(this.attrs.cache,!0);a.getAttribute(this.attrs.cache)&&a.removeAttribute(this.attrs.cache)})}function e(a,b){let c=0;[...b.children].forEach(b=>{const d=b.cloneNode(!0),e=[...a.children],f=e.slice(c);if(k(f,d))return c+=f.findIndex(a=>j(d,a)),void e[c].setAttribute(this.attrs.keep,!0);const g=e[c];d.setAttribute(this.attrs.keep,!0),g.parentNode.insertBefore(d,g.nextSibling)}),[...a.children].forEach(b=>{b.getAttribute(this.attrs.keep)?b.removeAttribute(this.attrs.keep):a.removeChild(b)})}function f({href:a,html:b}){history.pushState({href:a},'',a);const c=document.createElement('html');c.innerHTML=b;const d=document.body;d.innerHTML='',[...i('body',c)[0].childNodes].forEach(a=>d.appendChild(a)),this.head(document.head,c.querySelector('head'));const e=([a,...b])=>a?l(a,d,this.loaded).then(()=>e(b)):Promise.resolve();return e(i('script'))}var g='undefined'==typeof window?'undefined'==typeof global?'undefined'==typeof self?{}:self:global:window,h=function(a,b){return b={exports:{}},a(b,b.exports),b.exports}(function(a){function b(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var c=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();(function(){var d='undefined'==typeof process?function(a){return setTimeout(a,1)}:process.nextTick,e=function(){function a(c,d,e,f){return b(this,a),this.expire=f,this.max=c,this.notify=d,this.ttl=e,this.reset()}return c(a,[{key:'clear',value:function(){var a=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0];return this.reset(),!a&&this.notify&&d(this.onchange('clear',this.dump())),this}},{key:'clearTimer',value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:'timers';return this.has(a,b)&&(clearTimeout(this[b][a]),delete this[b][a]),this}},{key:'delete',value:function(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];return this.remove(a,b)}},{key:'dump',value:function(){var a=JSON.parse(JSON.stringify(this));return delete a.timers,JSON.stringify(a)}},{key:'evict',value:function(){return this.has(this.last)&&this.remove(this.last,!0),this.notify&&d(this.onchange('evict',this.dump())),this}},{key:'get',value:function(a){var b;return this.has(a)&&(b=this.cache[a].value,this.set(a,b),this.notify&&d(this.onchange('get',this.dump())),0<this.ttl&&this.clearTimer(a).setTimer(a)),b}},{key:'has',value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:'cache';return a in this[b]}},{key:'onchange',value:function(){}},{key:'remove',value:function(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],c='string'==typeof a?a:a.toString(),e=void 0;if(this.has(c)){var f=this.cache[c];delete this.cache[c],this.length--,0<this.ttl&&this.clearTimer(c),!1===b&&0<this.expire&&this.clearTimer(c,'expires'),this.has(f.previous)?(this.cache[f.previous].next=f.next,this.first===c&&(this.first=f.previous)):this.first===c&&(this.first=''),this.has(f.next)?(this.cache[f.next].previous=f.previous,this.last===c&&(this.last=f.next)):this.last===c&&(this.last=''),e=f}else this.first===c&&(this.first=''),this.last===c&&(this.last='');return!b&&this.notify&&d(this.onchange('remove',this.dump())),e}},{key:'reset',value:function(){var a=this;return void 0!==this.expires&&Object.keys(this.expires).forEach(function(b){return a.clearTimer(b,'expires')}),void 0!==this.timers&&Object.keys(this.timers).forEach(function(b){return a.clearTimer(b)}),this.cache={},this.expires={},this.first='',this.last='',this.length=0,this.timers={},this}},{key:'set',value:function(a,b){var c,e;return this.has(a)?(e=this.cache[a],e.value=b,e.next='',this.first!==a&&(e.previous=this.first),this.last===a&&''!==e.previous&&(this.last=e.previous)):(++this.length>this.max&&this.remove(this.last,!0),1===this.length&&(this.last=a),this.cache[a]={next:'',previous:this.first,value:b}),this.first!==a&&this.has(this.first)&&(c=this.cache[this.first],c.next=a,c.previous===a&&(c.previous='')),this.first=a,this.notify&&d(this.onchange('set',this.dump())),0<this.ttl&&this.clearTimer(a).setTimer(a),0<this.expire&&!1===this.has(a,'expires')&&this.setExpire(a),this}},{key:'setExpire',value:function(a){var b=this;this.expires[a]=setTimeout(function(){return b.clearTimer(a,'expires').clearTimer(a).remove(a)},this.expire)}},{key:'setTimer',value:function(a){var b=this;this.timers[a]=setTimeout(function(){return b.remove(a)},this.ttl)}},{key:'update',value:function(a){var b=this,c=JSON.parse(a);Object.keys(c).forEach(function(a){b[a]=c[a]})}}]),a}();a.exports=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1e3,b=!!(1<arguments.length&&arguments[1]!==void 0)&&arguments[1],c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:0;return new e(a,b,c,d)}})('undefined'==typeof window?g:window)}),i=(a,b=document)=>[...b.querySelectorAll(a)];const j=(c,a)=>c.outerHTML===a.outerHTML,k=(a,b)=>!!a.find(a=>j(a,b));var l=(a,b,c)=>new Promise((d,e)=>{if(c[a.src])return d();const f=document.createElement('script');if(a.src)return f.addEventListener('load',d),f.addEventListener('error',e),f.src=a.src,void b.appendChild(f);const g=`(() => {${a.innerText}})();`;f.appendChild(document.createTextNode(g)),b.appendChild(f),d()});const m=function({attrs:g}={}){return this instanceof m?void(this.attrs=Object.assign({once:'data-pre-once',keep:'data-pre-keep',cache:'data-pre-cached'},g),this.loader={},this.loaded={},this.cache=h(100,!0,0,1e4),this.cache.onchange=()=>this.links(),window.onpopstate=a=>b(a.currentTarget.location.href),this.init=a,this.load=b,this.preload=b,this.open=c,this.links=d,this.head=e,this.merge=f,this.report=a=>console.log('Error:',a),this.init()):new m({attrs:g})};var n=new m;return n});
